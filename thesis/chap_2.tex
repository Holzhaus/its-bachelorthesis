\chapter{Hintergrund} \label{chap:background}

\section{\acrfull{xml}}

\subsection{\acrfull{c14n}}

Logisch äquivalente \acrshort{xml}-Dokumente können sich in der konkreten Darstellung
stark unterscheiden. Das \gls{w3c} hat daher Richtlinien zur Umwandlung in eine
einheitliche Darstellungsweise---die sogenannte \emph{Kanonische Form}---
festgelegt. Der Umwandlungprozess wird \acrfull{c14n} genannt.

\begin{example}[Kanonisierung]
\label{ex:c14n}

Ein \acrshort{xml}-Dokument vor und nach der Kanonisierung. Beide Versionen sind
logisch äquivalent.

\begin{lstlisting}[language=xml]
<?xml version="1.0"?>
<entries>
  <entry     foo = "bar" />
  <entry foo='baz'  ></entry>
</entries>
\end{lstlisting}
\captionof{figure}{Das unkanonisiertes \acrshort{xml}-Dokument enthält überflüssigen Whitespace und z.T. einfache Hochkommas als Attributwert-Trennzeichen.}
\begin{lstlisting}[language=xml]
<entries>
  <entry foo="bar"></entry>
  <entry foo="baz"></entry>
</entries>
\end{lstlisting}
\captionof{figure}{Im kanonisierten \acrshort{xml}-Dokument wurde überflüssiger Whitespace entfernt, durchgehend das Anführungszeichen als Attributtrennzeichen verwendet und lediglich aus einem Start-Tag bestehende leere Elemente durch das entsprechende Start-End-Tag-Paar ersetzt.}
\end{example}

\subsubsection{Motivation}

\cite{siddiqui2002c14n}

\subsubsection{Arbeitsschritte}

Bei der \acrlong{c14n} werden grob folgende Änderungen am
\acrshort{xml}-Dokument vorgenommen\cite[Abschnitt 1.1]{boyer01c14n}:

\begin{enumerate}
    \item{} {Kodierung der Eingabe mit dem UTF-8-Zeichensatz}
    \item{} {Normalisieren der Zeilenumbrüche}\\\\
        Die Konventionen für die Speicherung von Zeilenenden (\texttt{EOL})
        sind je nach Betriebssystem unterschiedlich. So nutzen unixode
        Betriebssysteme wie Linux und BSD beispielsweise einen
        Zeilenumbruch\footnote{Unicode Code-Point \texttt{U+000A}:
        \texttt{LINE FEED (LF)}} (\texttt{{\textbackslash}n}), Windows und DOS hingegen
        nutzen die Kombination Wagenrücklauf\footnote{Unicode Code-Point
        \texttt{U+000D}: \texttt{CARRIAGE RETURN (CR)}} und Zeilenumbruch
        (\texttt{{\textbackslash}r{\textbackslash}n}). Ältere Mac-OS-Versionen setzen hingegen die
        Kombination Zeilenumbruch und Wagenrücklauf (\texttt{{\textbackslash}n{\textbackslash}r})
        ein.\cite[S.~212]{unicode9}
        Bei der Kanonisierung werden alle Varianten durch einen einfachen
        Zeilenumbruch ohne Wagenrücklauf (\texttt{{\textbackslash}n}) ersetzt.
    \item{} {Normalisieren der Attributwerte}\\\\
        Dabei werden einzelne oder mehrere aufeinanderfolgende Whitespace-Zeichen wie Leerzeichen, Tabulatoren und Zeilenumbrüche in Attributwerten zu einem einzelnen Leerzeichen zusammengefasst.
    \item{} {Zeichen- und Entity-Referenzen werden ersetzt}
    \item{} \texttt{CDATA}-Abschnitte werden in normale Text-Nodes umgewandelt
    \item{} \acrshort{xml}-Deklaration und \gls{dtd} werden entfernt
    \item{} Keere Elemente werden in Paare bestehend aus Start-End-Tags umgewandelt
    \item{} Whitespace außerhalb des Wurzelelements und innerhalb von Start- und End-Tags wird normalisiert
    \item{} Jeglicher Whitespace innerhalb Wurzelelements wird (mit Ausnahme der o.g. normalisierten Zeilenenden) unverändert belassen
    \item{} Alle Attributwert-Trennzeichen werden in Anführungszeichen (\enquote{double quotes})\footnote{Unicode Code-Point \texttt{U+0022}: \texttt{QUOTATION MARK}} umgewandelt
    \item{} Sonderzeichen in Attributwerten und Zeicheninhalt werden durch \acrshort{xml} Character References ersetzt.
    \item{} Überflüssige Namespace-Deklarationen werden entfernt.
    \item{} In der \texttt{ATTLIST} angegebene Vorgabeattribute werden zu allen Elementen hinzugefügt.
    \item{} Attribute und Namespace-Deklarationen aller Elemente werden in lexikographische Ordnung gebracht
\end{enumerate}

\subsubsection{Kommentare}

Die \gls{w3c}-Empfehlung für kanonisches XML erlaubt sowohl das ersatzlose Entfernen als auch das Beibehalten der Kommentare, wobei das Resultat in letzterem Fall als \emph{Kanonisches XML mit Kommentaren} (engl. \enquote{canonical XML with comments})\cite[Abschnitt 2.1]{boyer2001c14n}. Implementierung müssen in der Lage sein, kanonisches XML ohne Kommentare zu erstellen, während die Ünterstützung für kanonisches XML mit Kommentaren zwar empfohlen, jedoch nicht vorgeschrieben ist.

\subsubsection{Exklusive \acrlong{c14n}}

Einen Sonderfall stellt die Exklusive \acrlong{c14n} dar, die in einer separaten Empfehlung des \gls{w3c} beschrieben ist.\cite{boyer2002excc14n} Während bei der regulären (inklusiven) \acrlong{c14n} der Vorfahren-Kontext (z.B. Namespaces und Attribute im \acrshort{xml}-Namensraum) von Teildokumente eines XML-Dokuments erhalten bleibt, wird dieser bei der exklusiven \acrshort{c14n} verworfen.\cite[Abschnitt~18]{siddiqui2002c14n2} Dies kann insbesondere dann sinnvoll sein, wenn Teildokumente aus dem Quelldokumente herausgelöst und ggf. andere Dokumente eingebettet werden sollen (Re-Enveloping), ohne dass sich ihre digitale Signatur ändert.
