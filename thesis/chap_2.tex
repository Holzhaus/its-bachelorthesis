\chapter{Hintergrund} \label{chap:background}

\section{\acrfull{xml}}

\subsection{\acrfull{c14n}}

Logisch äquivalente \acrshort{xml}-Dokumente können sich in der konkreten Darstellung
stark unterscheiden. Das \gls{w3c} hat daher Richtlinien zur Umwandlung in eine
einheitliche Darstellungsweise---die sogenannte \emph{Kanonische Form}---
festgelegt. Der Umwandlungprozess wird \acrfull{c14n} genannt.\cite{boyer2001c14n}

\begin{example}[Kanonisierung]
\label{ex:c14n}

Ein \acrshort{xml}-Dokument vor und nach der Kanonisierung. Beide Versionen sind
logisch äquivalent.

\inputminted{xml}{ex-c14n-pre.xml}
\captionof{figure}{Das unkanonisierte \acrshort{xml}-Dokument enthält überflüssigen Whitespace und z.T. einfache Hochkommas als Attributwert-Trennzeichen.}
\inputminted{xml}{ex-c14n-post.xml}
\captionof{figure}{Im kanonisierten \acrshort{xml}-Dokument wurde überflüssiger Whitespace entfernt, durchgehend das Anführungszeichen als Attributtrennzeichen verwendet und lediglich aus einem Start-Tag bestehende leere Elemente durch das entsprechende Start-End-Tag-Paar ersetzt.}
\end{example}

\subsubsection{Motivation und Anwendungsbereich}

Durch die Flexibilität des \acrshort{xml}-Standards besteht die MöglichkeitInformationen durch eine Vielzahl \acrshort{xml}-Dokumente darzustellen.\cite{siddiqui2002c14n} Die im Beispiel \ref{ex:c14n} abgebildeten \acrshort{xml}-Dokumente haben einen identischen Informationsgehalt, lediglich die Darstellungsweisen unterscheiden sich. Allein die Möglichkeit, innerhalb eines Start-Tags eine beliebe Anzahl von Whitespace einzusetzen\cite[Produktionsregeln 3 und 40] führt bereits zu einer unendlichen Anzahl von logisch äquivalenten XML-Darstellungen einer Information.

Um die verschiedenden XML-Dokumenten enthaltene Logik vergleichbar zu machen, muss daher von der konkreten Darstellung abstrahiert werden.  \acrlong{c14n} überführt daher beliebige XML-Dokumente in eine \emph{Kanonische Form}, indem eine Reihe von Arbeitsschritten abgearbeitet werden, die in Abschnitt \ref{sec:c14nsteps} beschrieben sind.

\acrlong{c14n} wird vor allem im Bereich der Signaturerstellung und -verifikation eingesetzt. Dabei wird nicht das zu siginierende Datenobjekt selbst, sondern lediglich ein \emph{Digest} d.h. ein Hashwert des Objekts) signiert.\cite[Abschnitt 2.0]{bartel2008xmlsig} Subtile und für die Dokumentlogik irrelevante Unterschiede wie der Einsatz von abweichenden Zeilenumbrüchen oder die Nutzung von einfachen statt doppelten Hochkomma als Trennzeichen für Attribute würden dabei den Hashwert ändern und die Signatur ungültig werden lassen. Daher werden die Datenobjekte standardmäßig mittels \acrlong{c14n} transformiert.\cite[Abschnitt 4.3.3.2]{bartel2008xmlsig}

\subsubsection{Arbeitsschritte}

Bei der \acrlong{c14n} werden grob folgende Änderungen am
\acrshort{xml}-Dokument vorgenommen\cite[Abschnitt 1.1]{boyer2001c14n}:

\begin{enumerate}
    \item{} {Kodierung der Eingabe mit dem UTF-8-Zeichensatz}
    \item{} {Normalisieren der Zeilenumbrüche}\\\\
        Die Konventionen für die Speicherung von Zeilenenden (\texttt{EOL})
        sind je nach Betriebssystem unterschiedlich. So nutzen unixode
        Betriebssysteme wie Linux und BSD beispielsweise einen
        Zeilenumbruch\footnote{Unicode Code-Point \texttt{U+000A}:
        \texttt{LINE FEED (LF)}} (\texttt{{\textbackslash}n}), Windows und DOS hingegen
        nutzen die Kombination Wagenrücklauf\footnote{Unicode Code-Point
        \texttt{U+000D}: \texttt{CARRIAGE RETURN (CR)}} und Zeilenumbruch
        (\texttt{{\textbackslash}r{\textbackslash}n}). Ältere Mac-OS-Versionen setzen hingegen die
        Kombination Zeilenumbruch und Wagenrücklauf (\texttt{{\textbackslash}n{\textbackslash}r})
        ein.\cite[S.~212]{unicode9}
        Bei der Kanonisierung werden alle Varianten durch einen einfachen
        Zeilenumbruch ohne Wagenrücklauf (\texttt{{\textbackslash}n}) ersetzt.
    \item{} {Normalisieren der Attributwerte}\\\\
        Dabei werden einzelne oder mehrere aufeinanderfolgende Whitespace-Zeichen wie Leerzeichen, Tabulatoren und Zeilenumbrüche in Attributwerten zu einem einzelnen Leerzeichen zusammengefasst.
    \item{} {Zeichen- und Entity-Referenzen werden ersetzt}
    \item{} \texttt{CDATA}-Abschnitte werden in normale Text-Nodes umgewandelt
    \item{} \acrshort{xml}-Deklaration und \gls{dtd} werden entfernt
    \item{} Keere Elemente werden in Paare bestehend aus Start-End-Tags umgewandelt
    \item{} Whitespace außerhalb des Wurzelelements und innerhalb von Start- und End-Tags wird normalisiert
    \item{} Jeglicher Whitespace innerhalb Wurzelelements wird (mit Ausnahme der o.g. normalisierten Zeilenenden) unverändert belassen
    \item{} Alle Attributwert-Trennzeichen werden in Anführungszeichen (\enquote{double quotes})\footnote{Unicode Code-Point \texttt{U+0022}: \texttt{QUOTATION MARK}} umgewandelt
    \item{} Sonderzeichen in Attributwerten und Zeicheninhalt werden durch \acrshort{xml} Character References ersetzt.
    \item{} Überflüssige Namespace-Deklarationen werden entfernt.
    \item{} In der \texttt{ATTLIST} angegebene Vorgabeattribute werden zu allen Elementen hinzugefügt.
    \item{} Attribute und Namespace-Deklarationen aller Elemente werden in lexikographische Ordnung gebracht
\end{enumerate}

\subsubsection{Kommentare}

Die \gls{w3c}-Empfehlung für kanonisches XML erlaubt sowohl das ersatzlose Entfernen als auch das Beibehalten der Kommentare, wobei das Resultat in letzterem Fall als \emph{Kanonisches XML mit Kommentaren} (engl. \enquote{canonical XML with comments})\cite[Abschnitt 2.1]{boyer2001c14n}. Implementierung müssen in der Lage sein, kanonisches XML ohne Kommentare zu erstellen, während die Ünterstützung für kanonisches XML mit Kommentaren zwar empfohlen, jedoch nicht vorgeschrieben ist.

\subsubsection{Exklusive \acrlong{c14n}}

Einen Sonderfall stellt die Exklusive \acrlong{c14n} dar, die in einer separaten Empfehlung des \gls{w3c} beschrieben ist.\cite{boyer2002excc14n} Während bei der regulären (inklusiven) \acrlong{c14n} der Vorfahren-Kontext (z.B. Namespaces und Attribute im \acrshort{xml}-Namensraum) von Teildokumente eines XML-Dokuments erhalten bleibt, wird dieser bei der exklusiven \acrshort{c14n} verworfen.\cite[Abschnitt~18]{siddiqui2002c14n2} Dies kann insbesondere dann sinnvoll sein, wenn Teildokumente aus dem Quelldokumente herausgelöst und ggf. andere Dokumente eingebettet werden sollen (Re-Enveloping), ohne dass sich ihre digitale Signatur ändert.

\section{\acrfull{json}}

Vor allem im Bereich des Datenaustausch hat sich die \acrfull{json} als Alternative zum gängigen \acrshort{xml}-Format etabliert. Im Gegensatz zum dokumentorientierten Auszeichnungssprache \acrshort{xml} wird \acrshort{json} häufig als \emph{datenorientiert} bezeichnet.\cite{gupta2007xmljson}

\subsection{Datenmodell und Syntax}

Das \acrshort{json}-Format verfügt über mehrere verschiedene Datentypen, darunter die Containertypen \emph{Objekt} und \emph{Array}:\cite{ecma404}

\begin{description}
    \item[Objekte] werden mit geschweiften Klammern \texttt{\{\}}angegeben und enhalten eine kommaseparierten ungeordneten Liste von beliebig vielen Schlüssel-Wert-Paaren. Die Schlüssel müssen vom Typ Strings sein und dürfen im Objekt nur einmal vorkommen. Die Werte dürfen beliebigen Typs sein (auch weitere Objekte).
    \item[Arrays] sind neben \emph{Objekten} die zweite Containerklasse des \acrshort{json}-Formats und enhalten eine kommaseparierte geordnete Liste von Werten beliebigen Typs. Diese Liste wird von eckigen Klammern (\texttt{[]} umschlossen darf auch leer sein.
    \item[Strings] sind einfache Zeichenketten, die aus beliebig vielen Zeichen bestehen und von doppelten Anführungszeichen (\texttt{"}) umschlossen sind. Kontrollzeichen, doppelte Anführungszeichen und der Backslash (\texttt{\textbackslash})  müssen mit einem Backslash quotiert werden.
    \item[Zahlen] werden als Dezimalwert ohne führende Null dargestellt. Für negativen Werte kann ein Minuszeichen vorangestellt werden. Bei der Angabe von Nachkommastellen werden diese mittels eines Punkts (\texttt{.}) vom Ganzzahlteil getrennt. Auch die wissenschaftliche \enquote{E-Notation} ist erlaubt.
    \item[\texttt{true} / \texttt{false}] bezeichnet die Booleschen Werte \enquote{wahr} und \enquote{falsch}.
    \item[\texttt{null}] steht für den Nullwert.
\end{description}

\begin{definition}Formale Syntax der \acrfull{json}
\label{def:json}

Unerheblicher Whitespace (Tabulator\footnote{Unicode-Codepoint \texttt{U+0009}: \texttt{CHARACTER TABULATION}}, Zeilenumbruch\footnote{Unicode-Codepoint \texttt{U+000A}: \texttt{LINE FEED (LF)}}, Wagenrücklauf\footnote{Unicode-Codepoint \texttt{U+000D}: \texttt{CARRIAGE RETURN (CR)}} und Leerzeichen\footnote{Unicode-Codepoint \texttt{U+0020}: \texttt{SPACE}}) kann vor oder nach allen Token (\lit{\{}\footnote{Unicode-Codepoint \texttt{U+007B}: \texttt{LEFT CURLY BRACKET}}, \lit{\}}\footnote{Unicode-Codepoint \texttt{U+007D}: \texttt{RIGHT CURLY BRACKET}}, \lit{[}\footnote{Unicode-Codepoint \texttt{U+005B}: \texttt{LEFT SQUARE BRACKET}}, \lit{]}\footnote{Unicode-Codepoint \texttt{U+005D}: \texttt{RIGHT SQUARE BRACKET}}, \lit{:}\footnote{Unicode-Codepoint \texttt{U+003A}: \texttt{COLON}}, \lit{,}\footnote{Unicode-Codepoint \texttt{U+002C}: \texttt{COMMA}}) eingefügt werden.

\begin{grammar}
    <value> ::= \[[ \begin{stack}
                <object>\\
                <array>\\
                <string>\\
                <number>\\
                `true'\\
                `false'\\
                `null'
            \end{stack} \]]

    <object> ::= \[[ `\{' \begin{stack}
                \begin{rep}
                    <string> `:' <value>\\
                    `,'
                \end{rep}\\
        \end{stack} `\}' \]]

    <array> ::= \[[ `[' \begin{stack}
                \begin{rep}
                    <value>\\
                    `,'
                \end{rep}\\
        \end{stack} `]' \]]

    <number> ::= \[[
        \begin{stack}
            \\`-'
        \end{stack}
        \begin{stack}
            `0'\\
            "\lit1 - \lit9"
            \begin{rep}
                \\"\lit0 - \lit9"
            \end{rep}
        \end{stack}
        \begin{stack}\\
            `.' \begin{rep}
                    "\lit0 - \lit9"
                \end{rep}
        \end{stack}
        \begin{stack}\\
            \begin{stack}
                `e'\\
                `E'
            \end{stack}
            \begin{stack}
                \\
                `+'\\
                `-'\\
            \end{stack}
            \begin{rep}
                "\lit0 - \lit9"
            \end{rep}
        \end{stack}
        \]]

    <string> ::= \[[
        `\textquotedbl' \begin{stack}\\
                \begin{rep}
                    \begin{stack}
                        \tok{\color{black} Any Unicode char except \texttt{\textquotedbl}, \texttt{\textbackslash} or control char}\\
                        `\textbackslash' \begin{stack}
                            `\textquotedbl'\\
                            `\textbackslash'\\
                            `/'\\
                            `b'\\
                            `f'\\
                            `n'\\
                            `r'\\
                            `t'\\
                            `u' \tok{\color{black} 4 hexadecimal digits}
                        \end{stack}
                    \end{stack}
                \end{rep}
        \end{stack} `\textquotedbl'
        \]]
\end{grammar}
\end{definition}
